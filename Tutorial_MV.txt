ACTUALIZAR ARCHIA EN LA MÁQUINA VIRTUAL
(backend, frontend y servicios)

0) Conectarse a la máquina virtual por SSH
Miren el tutorial


1) Ir a la carpeta del proyecto

cd /home/proyecto/ArchIA

2) Traer los cambios desde GitHub
Cambiar NOMBRE_DE_LA_RAMA por main, develop, etc.

git pull origin NOMBRE_DE_LA_RAMA

#########################

BACKEND (FASTAPI)

#########################

1) Ir a la carpeta del backend

cd /home/proyecto/ArchIA/back

2) Activar el entorno virtual (venv)

source venv/bin/activate

3) (Opcional) Instalar dependencias nuevas
Ejecutar SOLO si cambió requirements.txt o se agregaron librerías

pip install -r requirements.txt

4) Verificar que el archivo .env tenga las llaves correctas
(OPENAI_API_KEY, etc.). Editar solo si es necesario:
nano /home/proyecto/ArchIA/back/.env
5) Reiniciar el servicio del backend para aplicar cambios

sudo systemctl restart archia-backend

6) Comprobar que el backend quedó corriendo sin errores

sudo systemctl status archia-backend -n 20

#########################

FRONTEND (REACT/VITE)

#########################

1) Ir a la carpeta del frontend

cd /home/proyecto/ArchIA/front

2) (Opcional) Instalar dependencias nuevas de Node
Ejecutar SOLO si cambió package.json / package-lock.json

npm install

3) Construir el frontend en modo producción

npm run build

4) Limpiar la carpeta que sirve Nginx y copiar el nuevo build

sudo rm -rf /var/www/archia/*
sudo cp -r dist/* /var/www/archia/

5) Probar la configuración de Nginx

sudo nginx -t

6) Reiniciar Nginx para aplicar cambios

sudo systemctl restart nginx

7) (Opcional) Ver el estado del servicio

sudo systemctl status nginx -n 10

#################################

NGROK (TÚNEL PÚBLICO, OPCIONAL)

#################################

Ngrok ya está configurado como servicio (ngrok-archia).
Solo se usa esto si algún día se quiere revisar o reiniciar:
Ver estado del túnel

sudo systemctl status ngrok-archia -n 20

Reiniciar el túnel si es necesario

sudo systemctl restart ngrok-archia

Ver en los logs la URL pública actual (https://xxxxx.ngrok-free.dev
)

sudo journalctl -u ngrok-archia -n 40 --no-pager | grep "url="

#################################

RESUMEN RÁPIDO (CASO TÍPICO)

#################################

1) ssh a la MV
2) cd /home/proyecto/ArchIA
git pull origin NOMBRE_DE_LA_RAMA
3) Backend:
cd back
source venv/bin/activate
pip install -r requirements.txt (solo si hay nuevas libs)
sudo systemctl restart archia-backend
4) Frontend:
cd ../front
npm install (solo si hay nuevas libs)
npm run build
sudo rm -rf /var/www/archia/*
sudo cp -r dist/* /var/www/archia/
sudo systemctl restart nginx